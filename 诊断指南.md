# 错误诊断指南

## "Server error. Please try again later." 错误排查

如果看到这个错误，请按以下步骤排查：

### 1. 检查后端服务器是否运行

**Windows**:
```powershell
netstat -ano | findstr :3001
```

**Linux/macOS**:
```bash
lsof -i :3001
# 或
netstat -an | grep 3001
```

如果端口没有被占用，说明后端服务器未启动。

### 2. 检查后端日志

查看运行后端服务器的命令行窗口，查看是否有错误信息。

常见错误：
- 数据库连接失败
- 端口被占用
- 依赖缺失

### 3. 检查浏览器控制台

1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签
3. 查看是否有红色错误信息
4. 查看 Network 标签，检查失败的请求

### 4. 测试 API 连接

运行测试脚本：
```bash
node test-api.js
```

如果测试成功，说明后端正常，问题可能在前端。

### 5. 常见问题及解决方案

#### 问题1: CORS 错误
**症状**: 浏览器控制台显示 CORS 相关错误

**解决**: 
- 检查 `ALLOWED_ORIGINS` 环境变量
- 确保前端地址在允许列表中
- 默认允许: `http://localhost:5000` 和 `http://localhost:3000`

#### 问题2: 数据库错误
**症状**: 后端日志显示数据库连接错误

**解决**:
- 检查 `DB_PATH` 环境变量
- 确保数据库文件路径正确
- 检查文件权限

#### 问题3: 端口冲突
**症状**: 后端无法启动，提示端口被占用

**解决**:
- 修改 `.env` 文件中的 `PORT` 配置
- 或关闭占用端口的程序

#### 问题4: 依赖缺失
**症状**: 启动时提示找不到模块

**解决**:
```bash
cd backend-express
npm install
```

### 6. 启用详细错误日志

在开发模式下，错误会显示更多详细信息：

1. 确保 `NODE_ENV` 未设置或设置为 `development`
2. 查看浏览器控制台的完整错误信息
3. 查看后端服务器的控制台输出

### 7. 手动测试 API

使用 curl 或 Postman 测试：

```bash
# 测试获取文档列表
curl http://localhost:3001/api/documents

# 测试创建文档
curl -X POST http://localhost:3001/api/documents \
  -H "Content-Type: application/json" \
  -d '{"title":"Test Document"}'
```

### 8. 重置环境

如果问题持续存在：

1. 停止所有服务器
2. 删除 `node_modules` 和重新安装依赖
3. 检查 `.env` 文件配置
4. 重新启动服务器

### 需要帮助？

如果以上步骤都无法解决问题，请提供：
1. 浏览器控制台的完整错误信息
2. 后端服务器的完整日志
3. `test-api.js` 的运行结果
4. 操作系统和 Node.js 版本

